<body>

    <style>
        button {
          padding: 8px 14px;
          margin-right: 6px;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          background: #1e90ff;
          color: white;
        }
        button:hover {
          background: #0b5ed7;
        }
      </style>

    <h1>ðŸŽ¯ Selenium Testing Video Hub</h1>
    <p>Search Selenium automation tutorials</p>
    <div id="categories" style="margin-bottom:15px;">
        <button onclick="loadCategory('selenium testing tutorial')">Basics</button>
        <button onclick="loadCategory('selenium java automation')">Java</button>
        <button onclick="loadCategory('selenium python automation')">Python</button>
        <button onclick="loadCategory('selenium framework tutorial')">Framework</button>
        <button onclick="loadCategory('selenium interview questions')">Interview</button>
      </div>
    
    <input
  type="text"
  id="searchInput"
  placeholder="Search: selenium java, python, testng..."
  onkeyup="debouncedSearch(this.value)"
  style="width:300px;padding:10px;"
/>
    <button onclick="searchVideos()">Search</button>
    
    <br><br>
    
    <div class="grid" id="videos"></div>
    
    <script>
        let nextPageToken = null;
        let currentQuery = "";
        let isLoading = false;
        let debounceTimer = null;
        
        function renderVideos(videos, append = false) {
          const container = document.getElementById("videos");
          if (!append) container.innerHTML = "";
        
          videos.forEach(v => {
            container.innerHTML += `
              <div class="card">
                <a href="https://www.youtube.com/watch?v=${v.id.videoId}" target="_blank">
                  <img src="${v.snippet.thumbnails.medium.url}">
                  <h4>${v.snippet.title}</h4>
                </a>
                <p>${v.snippet.channelTitle}</p>
              </div>
            `;
          });
        }
        
        function loadVideos(query = "", append = false) {
          if (isLoading) return;
          isLoading = true;
        
          currentQuery = query;
        
          let url = `/api/videos?q=${encodeURIComponent(query)}`;
          if (append && nextPageToken) {
            url += `&pageToken=${nextPageToken}`;
          }
        
          fetch(url)
            .then(res => res.json())
            .then(data => {
              renderVideos(data.videos, append);
              nextPageToken = data.nextPageToken;
              isLoading = false;
            });
        }
        
        function debouncedSearch(value) {
          clearTimeout(debounceTimer);
          debounceTimer = setTimeout(() => {
            if (value.trim().length > 2) {
              nextPageToken = null;
              loadVideos(value, false);
            }
          }, 500);
        }
        
        function loadCategory(keyword) {
          document.getElementById("searchInput").value = keyword;
          nextPageToken = null;
          loadVideos(keyword, false);
        }
        
        // Infinite scroll trigger
        window.addEventListener("scroll", () => {
          if (
            window.innerHeight + window.scrollY >= document.body.offsetHeight - 200 &&
            nextPageToken
          ) {
            loadVideos(currentQuery, true);
          }
        });
        
        // Initial load
        loadVideos();
        </script>
    </body>